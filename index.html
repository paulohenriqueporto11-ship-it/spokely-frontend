<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spokely Focus</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f0f0f; color: #eee; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: #1f1f1f; padding: 2rem; border-radius: 16px; text-align: center; width: 320px; border: 1px solid #333; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        /* Header com XP */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .level-info { text-align: left; width: 100%; }
        .xp-track { width: 100%; height: 8px; background: #333; border-radius: 4px; margin-top: 5px; overflow: hidden; }
        .xp-fill { height: 100%; background: #adff2f; width: 0%; transition: width 0.5s ease; }
        
        /* Timer */
        .timer-box { margin: 30px 0; }
        .timer-text { font-size: 4.5rem; font-weight: 700; color: #fff; font-family: monospace; letter-spacing: -2px; }
        .status-msg { color: #666; margin-top: -10px; font-size: 0.9rem; }

        /* Bot√£o */
        button {
            width: 100%; padding: 15px; font-size: 1rem; font-weight: bold;
            background: #adff2f; color: #000; border: none; border-radius: 8px;
            cursor: pointer; transition: 0.2s; text-transform: uppercase;
        }
        button:hover { background: #bfff55; transform: scale(1.02); }
        button:disabled { background: #333; color: #888; cursor: wait; transform: none; }
    </style>
</head>
<body>

<div class="card">
    <div class="header">
        <div class="level-info">
            <div style="display:flex; justify-content:space-between; font-size:0.8rem; color:#888;">
                <span>N√çVEL <b id="lvlDisplay" style="color:#fff">1</b></span>
                <span id="xpText">0 XP</span>
            </div>
            <div class="xp-track">
                <div id="xpBar" class="xp-fill"></div>
            </div>
        </div>
    </div>

    <div class="timer-box">
        <div id="timerDisplay" class="timer-text">00:10</div>
        <p id="statusMsg" class="status-msg">Sess√£o de Teste (10s)</p>
    </div>

    <button id="btnAction">INICIAR FOCO</button>
</div>

<script>
    // --- CONFIG ---
    const API_URL = "https://spokely-backend-1.onrender.com"; // SEU BACKEND
    
    // ‚ö†Ô∏è SUBSTITUA PELO SEU ID AQUI (O MESMO QUE USOU ANTES)
    const userId = "81d8e5b7-edb2-4227-9fb2-8d4863b51414"; 

    // --- ELEMENTOS ---
    const btn = document.getElementById('btnAction');
    const timerDisplay = document.getElementById('timerDisplay');
    const xpBar = document.getElementById('xpBar');
    const lvlDisplay = document.getElementById('lvlDisplay');
    const xpText = document.getElementById('xpText');
    
    let timeLeft = 10; 
    let interval = null;

    // --- FUN√á√ïES ---

    btn.onclick = () => {
        if (interval) return;

        // Trava a tela
        btn.disabled = true;
        btn.innerText = "FOCADO... ü§´";
        document.getElementById('statusMsg').innerText = "N√£o feche a aba!";

        // Inicia contagem
        interval = setInterval(() => {
            timeLeft--;
            timerDisplay.innerText = `00:${timeLeft < 10 ? '0'+timeLeft : timeLeft}`;

            if (timeLeft <= 0) {
                clearInterval(interval);
                finishSession();
            }
        }, 1000); // 1 segundo
    };

    async function finishSession() {
        timerDisplay.innerText = "üéâ";
        
        try {
            // Avisa o backend que "trabalhou" 1 minuto (simula√ß√£o)
            const res = await fetch(`${API_URL}/complete-session`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ user_id: userId, minutes: 1 }) 
            });
            
            const data = await res.json();

            if (data.success) {
                // Atualiza N√≠vel e XP na tela
                lvlDisplay.innerText = data.new_level;
                xpBar.style.width = `${data.current_xp}%`; // Assume que 100xp = 100% (simplificado)
                xpText.innerText = `${data.current_xp} XP`;

                // Feedback visual
                btn.style.background = "#fff";
                btn.innerText = `+${data.xp_earned} XP GANHO!`;
                
                if (data.leveled_up) alert("SUBIU DE N√çVEL! üî•");
            } else {
                alert("Erro: " + (data.error || "Desconhecido"));
            }

        } catch (e) {
            console.error(e);
            btn.innerText = "ERRO AO SALVAR";
        }

        // Reseta tudo depois de 3 segundos pra testar de novo
        setTimeout(() => {
            timeLeft = 10;
            timerDisplay.innerText = "00:10";
            btn.innerText = "INICIAR FOCO";
            btn.style.background = "#adff2f";
            document.getElementById('statusMsg').innerText = "Sess√£o de Teste (10s)";
            btn.disabled = false;
            interval = null;
        }, 3000);
    }
</script>

</body>
</html>
